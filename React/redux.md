# Redux

벨로퍼트와 함께하는 모던 리액트 참고. [링크](https://react.vlpt.us/redux/)

리덕스는 리액트 생태계에서 가장 사용률이 높은 상태관리 라이브러리.

# 목차

- [리덕스와 Context API 차이](#리덕스와-Context-API-차이)
- [리덕스에서 사용되는 키워드 숙지하기](#리덕스에서-사용되는-키워드-숙지하기)
- [리덕스의 3가지 규칙](#리덕스의-3가지-규칙)

# 리덕스와 Context API 차이

Context API 를 사용해도 글로벌 상태 관리를 할 수 있고 상태 관리 로직을 분리 할 수 있음.

그렇다면 리덕스를 사용하는 것 과 Context API를 사용하는 것은 어떠한 차이가 있을까?

### 1. 미들웨어

리덕스의 미들웨어를 사용하면 액션 객체가 리듀서에서 처리되기 전에 우리가 원하는 작업들을 수행 할 수 있음.

미들웨어는 주로 비동기 작업을 처리 할 때 많이 사용.

### 2. 유용한 함수와, Hooks

`connect` 함수를 사용하면 리덕스의 상태 또는 액션 생성 함수를 컴포넌트의 props 로 받아올 수 있음. `useSelector`, `useDispatch`, `useStore` 과 같은 Hooks를 사용하면 손쉽게 상태를 조회하거나 액션을 디스패치 할 수도 있음.

`connect` 함수와 `useSelector` 함수에는 내부적으로 최적화가 잘 이루어져있어서 실제 상태가 바뀔때만 컴포넌트가 리렌더링됨.

### 3. 하나의 커다란 상태

리덕스에서는 모든 글로벌 상태를 하나의 커다란 상태 객체에 넣어서 사용하는 것이 필수.

매번 Context를 새로 만드는 수고로움을 덜 수 있음.

### 그럼 리덕스는 언제 써야 할까?

다음 사항들을 고려.

### 1. 프로젝트의 규모가 큰가?

- Yes: 리덕스
- No: Context API

### 2. 비동기 작업을 자주 하게 되는가?

- Yes: 리덕스
- No: Context API

### 3. 리덕스를 배워보니까 사용하는게 편한가?

- Yes: 리덕스
- No: Context API 또는 MobX

# 리덕스에서 사용되는 키워드 숙지하기

## 액션 (Action)

상태에 어떠한 변화가 필요하게 될 땐, 우리는 액션이란 것을 발생.

하나의 객체로 표현.

액션 객체는 type 필드를 필수적으로 가지고 있어야하고 그 외의 값들은 개발자 마음대로 넣어줄 수 있음.

```js
{
  type: "ADD_TODO",
  data: {
    id: 0,
    text: "리덕스 배우기"
  }
}
```

## 액션 생성함수 (Action Creator)

액션을 만드는 함수.

단순히 파라미터를 받아와서 액션 객체 형태로 만듬.

```js
export function addTodo(data) {
  return {
    type: "ADD_TODO",
    data,
  };
}

// 화살표 함수로도 만들 수 있습니다.
export const changeInput = (text) => ({
  type: "CHANGE_INPUT",
  text,
});
```

나중에 컴포넌트에서 더욱 쉽게 액션을 발생시키기 위함. 그래서 보통 함수 앞에 export 키워드를 붙여서 다른 파일에서 불러와서 사용.

## 리듀서 (Reducer)

변화를 일으키는 함수.

현재의 상태와, 전달 받은 액션을 참고하여 새로운 상태를 만들어서 반환.(`useReducer`를 사용할 때 작성하는 리듀서와 똑같은 형태)

```js
function counter(state, action) {
  switch (action.type) {
    case "INCREASE":
      return state + 1;
    case "DECREASE":
      return state - 1;
    default:
      return state;
  }
}
```

`useReducer` 에선 일반적으로 default: 부분에 throw new Error('Unhandled Action')과 같이 에러를 발생시키도록 처리.

리덕스의 리듀서에서는 기존 state를 그대로 반환하도록 작성.

리덕스를 사용 할 때에는 여러개의 리듀서(서브 리듀서)를 만들고 이를 합쳐서 루트 리듀서 (Root Reducer)를 만들 수 있음.

## 스토어 (Store)

리덕스에서는 한 애플리케이션당 하나의 스토어를 만들어야함.

스토어 안에는, 현재의 앱 상태와, 리듀서가 들어가있고, 추가적으로 몇가지 내장 함수들이 있음.

## 디스패치 (dispatch)

디스패치는 스토어의 내장함수 중 하나.

디스패치는 액션을 발생 시키는 것. dispatch 라는 함수에는 액션을 파라미터로 전달. (`dispatch(action)`)

그렇게 호출을 하면, 스토어는 리듀서 함수를 실행시켜서 해당 액션을 처리하는 로직이 있다면 액션을 참고하여 새로운 상태를 만들어줌.

## 구독 (subscribe)

스토어의 내장함수 중 하나.

함수 형태의 값을 파라미터로 받아옴.

subscribe 함수에 특정 함수를 전달해주면, 액션이 디스패치 되었을 때 마다 전달해준 함수가 호출.

리액트에서 리덕스를 사용하게 될 때 보통 이 함수를 직접 사용하는 일은 별로 없음. 그 대신에 react-redux 라는 라이브러리에서 제공하는 `connect` 함수 또는 `useSelector` Hook 을 사용하여 리덕스 스토어의 상태에 구독함.

# 리덕스의 3가지 규칙

## 1. 하나의 애플리케이션 안에는 하나의 스토어.

여러개의 스토어를 사용하는것은 사실 가능하기는 하나, 권장되지는 않음.

## 2. 상태는 읽기전용

기존의 상태는 건들이지 않고 새로운 상태를 생성하여 업데이트 해주는 방식.

이렇게 하면 나중에 개발자 도구를 통해서 뒤로 돌릴 수도 있고 다시 앞으로 돌릴 수도 있음.

불변성을 유지하면 `shallow equality` 검사를 함. 이를 통해 겉핥기 식으로 비교를 하여 좋은 성능을 유지 가능.

## 3. 리듀서는 순수한 함수여야 함

순수한 함수?

- 리듀서 함수는 이전 상태와, 액션 객체를 파라미터로 받음.
- 이전의 상태는 절대로 건들이지 않고, 변화를 일으킨 새로운 상태 객체를 만들어서 반환.
- 똑같은 파라미터로 호출된 리듀서 함수는 언제나 똑같은 결과값을 반환해야만 함.

**동일한 인풋이라면 언제나 동일한 아웃풋이 되야함.**

new Date(), 랜덤 숫자를 생성 혹은, 네트워크에 요청 같은 작업은 리듀서 바깥에서 처리. 그런 작업을 위해 리덕스 미들웨어를 사용.
